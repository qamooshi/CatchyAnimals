<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Word Catcher - Stable Final</title>

<style>
  * { box-sizing: border-box; }
  body { margin:0; background:#fef6e4; font-family:Arial; overflow:hidden; }
   #game {
  position: relative;
  width: 100vw;
  height: calc(var(--vh, 1vh) * 100); /* Ø¨Ù‡ Ø¬Ø§ÛŒ 100vh */
  overflow: hidden; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ */
}

#topBar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 64px;

  z-index: 1000;
}

/* Ø¬ÙˆÙ† Ù‡Ø§ Ø¨Ø§Ù„Ø§ Ú¯ÙˆØ´Ù‡ Ø³Ù…Øª Ú†Ù¾ */
#hearts {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 24px;
}

/* Ø¯Ú©Ù…Ù‡ Ù¾Ø§Ø² Ø¨Ø§Ù„Ø§ Ú¯ÙˆØ´Ù‡ Ø³Ù…Øª Ø±Ø§Ø³Øª */
#pauseBtn {
  position: absolute;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 34px;
  background: none;
  border: none;
  color: white;
  cursor: pointer;
}

/* Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ³Ø·: Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ø­ÛŒÙˆØ§Ù† Ù‡Ø¯Ù */
#centerInfo {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  line-height: 1.2;
  color: black;
}

#score {
  position: absolute;
  top: -20px;           /* Ú©Ù…ØªØ± Ø´Ø¯ ØªØ§ Ø¨Ø§Ù„Ø§ØªØ± Ø¨Ø±Ù‡ */
  left: 50%;
  transform: translateX(-50%);
  
  font-family: 'Comic Sans MS', 'Chalkboard', 'Arial', sans-serif;
  font-size: 62px;
  font-weight: bold;
  
  color: #ffde59;
  text-shadow: 2px 2px 0 #ff6a6a, 4px 4px 0 #6aafff;
  letter-spacing: 2px;
  
  transition: transform 0.2s ease;
  z-index: 25;
}

#target {
  position: absolute;
  top: 50px;           /* Ú©Ù…ØªØ± Ø´Ø¯ ØªØ§ Ø¨Ø§Ù„Ø§ØªØ± Ø¨Ø±Ù‡ØŒ Ø§Ù…Ø§ Ø²ÛŒØ± score Ø¨Ù…ÙˆÙ†Ù‡ */
  left: 50%;
  transform: translateX(-50%);
  font-size: 20px;     /* Ú©Ù…ÛŒ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ */
  opacity: 0.95;
  font-weight: bold;
  color: #ffde59;

  text-shadow: 1px 1px 2px #333;
}


  #player {
    position:absolute; bottom:76px; left: calc(50% - 45px); 
    
    width:90px; height:90px;
    background:url('images/cat.png') no-repeat center/contain;
    touch-action:none;
z-index:7;
  }

  .word {
    position:absolute;
    padding:12px 20px;
    background:#ffd803;
    border-radius:18px;
    font-size:26px;
    font-weight:bold;
    user-select:none;
  }

  .word.correct { background:#7CFF7C; }
  .word.wrong   { background:#FF7C7C; }

  #message,#levelUp {
    position:absolute; width:100%; text-align:center;
    font-size:32px; top:40%; display:none; z-index:30;
  }

#startBtn {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  font-size:34px;
font-weight: bold;
  padding:22px 44px;
  border-radius:30px;
  border:none;
  background:#ffde59;
box-shadow: 4px 4px 0 #ff6a6a;
  z-index:50;
display:block;
}
 

#levelUp {
  position:absolute;
  width:100%;
  text-align:center;
  font-size:40px;
  top:40%;
  z-index:30;
  color:#333;
  font-weight:bold;
  animation: none;
}

@keyframes levelPop {
  0%   { transform:scale(0.4); opacity:0; }
  60%  { transform:scale(1.2); opacity:1; }
  100% { transform:scale(1);   opacity:1; }
}
#ground {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 80px;       /* Ø§Ø±ØªÙØ§Ø¹ Ø²Ù…ÛŒÙ† */
  background: #654321; /* Ø±Ù†Ú¯ Ø²Ù…ÛŒÙ† (Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ) */
  z-index: 5;
}

#gameOverScreen {
  position: fixed;
  inset: 0;
  background: #fef6e4;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 100;
}

#gameOverScreen h1 {
  font-size: 48px;
  margin-bottom: 20px;
}

#gameOverScreen p {
  font-size: 28px;
  margin-bottom: 30px;
}

#gameOverScreen button {
  font-size: 22px;
  padding: 14px 30px;
  border-radius: 20px;
  border: none;
  background: #8bd3dd;
}


#line1, .line1 {
  color: #6aafff;   /* Ø²Ø±Ø¯ Ø´Ø§Ø¯ */
  font-size: 32px;
  font-weight: bold;
}

#line2, .line2 {
  color: #ff6a6a;   /* Ù‚Ø±Ù…Ø² Ø¬Ø°Ø§Ø¨ */
  font-size: 32px;
  font-weight: bold;
}


#guideMessage {
  position: absolute;
  top: 45%;
  left: 50%;
  transform: translate(-50%, -50%);
    text-shadow: 2px 2px 0 #ffde59;
  text-align: center;
  z-index: 50;
  display: none; /* Ø§ÙˆÙ„ Ù…Ø®ÙÛŒ */
}

#hitFlash {
  position: absolute;
  inset: 0;             /* Ú©Ù„ ØµÙØ­Ù‡ */
  background: rgba(255,0,0,0); /* Ø§ÙˆÙ„ transparent */
  pointer-events: none; /* Ú©Ù„ÛŒÚ©â€ŒÙ‡Ø§ Ø§Ø²Ø´ Ø±Ø¯ Ø¨Ø´Ù† */
  z-index: 1000;        /* Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ù‡Ù…Ù‡ */
  transition: background 0.2s ease; /* Ø¨Ø±Ø§ÛŒ fade */
}

#bottomArrow {
  position: fixed;
  bottom: 5px;   /* Ú©Ù…ÛŒ Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ø²Ù…ÛŒÙ† */
  left: 50%;
  transform: translateX(-50%);
  width: 160px;
  z-index: 60;
  display: none;
  opacity: 0.9;
}

.heart {
  position:absolute;
  width: 48px;
  height: 48px;
  background: url('images/heart.png') no-repeat center/contain;
  user-select:none;
  pointer-events:none;
}


</style>
<script>
  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø±ØªÙØ§Ø¹ ÙˆØ§Ù‚Ø¹ÛŒ ØµÙØ­Ù‡ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
  let vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);

  window.addEventListener('resize', () => {
    vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  });
</script>
</head>


<audio id="bgMusic" loop>
  <source src="audio/background.mp3" type="audio/mpeg">
</audio>

<audio id="errorSound">
  <source src="audio/error.mp3" type="audio/mpeg">
</audio>


<body>
<div id="game">
<div id="hitFlash"></div>

  <div id="topBar">
  <div id="hearts"></div>
  <div id="centerInfo">
    <div id="score"></div>
    <div id="target"></div>
  </div>
  <button id="pauseBtn" onclick="togglePause()">â¸</button>
</div>


  <div id="player"></div>
  <div id="message"></div>
  <div id="levelUp"></div>
  <button id="startBtn" onclick="startGame()">Start</button>
<div id="ground"></div>
  </div>


<div id="gameOverScreen">
  <h1>Game Over</h1>
  <p id="finalScore"></p>
  <button onclick="restartGame()">Play Again</button>
</div>

<div id="guideMessage">
  <span class="line1">Catch the correct animal!</span><br>
  <span class="line2">Avoid the wrong ones!</span>
</div>

<img id="bottomArrow" src="images/arrow.png" />

<script>
const levels = [
  { target:"Cat",  emoji:"ğŸ±", words:["Cat","Dog","Monkey","Lion"], image:"images/cat.png", bg:"url('images/ca.jpg') center/cover", groundColor:"#2f3042"},
  { target:"Dog",  emoji:"ğŸ¶", words:["Dog","Cat","Sheep","Frog"],   image:"images/dog.png", bg:"url('images/do.jpg') center/cover", groundColor:"#277531" },
  { target:"Monkey", emoji:"ğŸµ", words:["Monkey","Jellyfish","Lion","Dog"],image:"images/monkey.png", bg:"url('images/mo.jpg') center/cover", groundColor:"#8B9651" },
  { target:"Jellyfish", emoji:"ğŸª¼", words:["Jellyfish","Cat","Dog","Monkey"], image:"images/jellyfish.png", bg:"url('images/je.jpg') center/cover", groundColor:"#E3C28D" },
  { target:"Lion", emoji:"ğŸ¦", words:["Lion","Tiger","Jellyfish","Mouse"], image:"images/lion.png", bg:"url('images/li.jpg') center/cover", groundColor:"#665138" },
  { target:"Frog", emoji:"ğŸ¸", words:["Frog","Cat","Lion","Dog"], image:"images/frog.png", bg:"url('images/fr.jpg') center/cover", groundColor:"#40825E" },
  { target:"Mouse", emoji:"ğŸ­", words:["Mouse","Tiger","Crab","Penguin"], image:"images/mouse.png", bg:"url('images/mou.jpg') center/cover", groundColor:"#8E7677" },
  { target:"Crab", emoji:"ğŸ¦€", words:["Crab","Sheep","Panda","Mouse"], image:"images/crab.png", bg:"url('images/cr.jpg') center/cover", groundColor:"#e3c770" },
  { target:"Owl", emoji:"ğŸ¦‰", words:["Owl","Tiger","Lion","Penguin"], image:"images/owl.png", bg:"url('images/ow.jpg') center/cover", groundColor:"#455533" },
  { target:"Panda", emoji:"ğŸ¼", words:["Panda","Owl","Sheep","Monkey"], image:"images/panda.png", bg:"url('images/pa.jpg') center/cover", groundColor:"#6f7a47" },
  { target:"Penguin",  emoji:"ğŸ§", words:["Penguin","Panda","Frog","Mouse"],   image:"images/penguin.png", bg:"url('images/pe.jpg') center/cover", groundColor:"#c4e5fe" },
  { target:"Sheep",  emoji:"ğŸ‘", words:["Sheep","Jellyfish","Panda","Lion"], image:"images/sheep.png", bg:"url('images/sh.jpg') center/cover", groundColor:"#7ba631"},
  { target:"Tiger", emoji:"ğŸ¯", words:["Tiger","Penguin","Frog","Crab"],image:"images/tiger.png", bg:"url('images/ti.jpg') center/cover", groundColor:"#667f36" }
  



];

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

let shuffledLevels=[...levels];
shuffle(shuffledLevels);

let spawnInterval = 2000;
let score=0, lives=3, levelIndex=0, speed=2.4;
let gameOver=false, isPaused=true;
let words=[], lastSpawn=0;
let correctOnThisAnimal = 0;
let animalStartTime = Date.now();
let hasStarted = false;
let pauseStartTime = 0;
let isTransitioning = false;


const player=document.getElementById("player");
const targetEl=document.getElementById("target");
const scoreEl=document.getElementById("score");
const heartsEl=document.getElementById("hearts");
const levelUp=document.getElementById("levelUp");
const message=document.getElementById("message");
const game=document.getElementById("game");
const MAX_CORRECT = 5;   // N
const MAX_TIME = 40000; // T = 40 Ø«Ø§Ù†ÛŒÙ‡
const startBtn = document.getElementById("startBtn");
const pauseBtn = document.getElementById("pauseBtn");
const bgMusic = document.getElementById("bgMusic");
const bottomArrow = document.getElementById("bottomArrow");

const praiseMessages = [
  "Nice work!",
  "Good job!",
  "Excellent!",
  "Amazing!",
  "Well done!",
  "Great!"
];


function updateUI(){
  const lvl=shuffledLevels[levelIndex];
  targetEl.textContent=`${lvl.target} ${lvl.emoji}`;
  scoreEl.textContent=`${score}`;
  heartsEl.textContent="â¤ï¸".repeat(lives);
  player.style.backgroundImage=`url('${lvl.image}')`;
  game.style.background = lvl.bg;
ground.style.backgroundColor = lvl.groundColor;
}

// ÙÙ‚Ø· ÙÙ„Ú¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…ØŒ Ø­Ø°Ù ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ø§Ø®Ù„ loop
function clearWords(){
  words.forEach(w => w.toRemove = true);
}

function spawnWord(){
  const lvl=shuffledLevels[levelIndex];
  const text=lvl.words[Math.floor(Math.random()*lvl.words.length)];
  const el=document.createElement("div");
  el.className="word";
  el.textContent=text;
  el.style.left=Math.random()*(window.innerWidth-150)+"px";
  el.style.top="-10px";
  el.style.opacity = 0;

game.appendChild(el);

  words.push({
    el,
    y:-10,
    isTarget:text.toLowerCase()===lvl.target.toLowerCase(),
    caught:false,
    toRemove:false
  });
}

function isSafePosition(x, y, width=50, height=50){
  for(const w of words){
    const rect = w.el.getBoundingClientRect();
    const wx = rect.left;
    const wy = rect.top;
    const ww = rect.width;
    const wh = rect.height;

    if( x < wx + ww &&
        x + width > wx &&
        y < wy + wh &&
        y + height > wy ){
      return false;
    }
  }
  return true;
}



function spawnHeart(){
  let x, y;
  let tries = 0;

  do {
    x = Math.random()*(window.innerWidth-50);
    y = -80; // Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø² Ø¨Ø§Ù„Ø§ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†Ù‡
    tries++;
  } while(!isSafePosition(x, y) && tries < 10);

  const el = document.createElement("div");
  el.className = "heart";
  el.style.left = x+"px";
  el.style.top = y+"px";
  game.appendChild(el);

  words.push({
    el,
    y: y,
    isHeart:true,
    caught:false,
    toRemove:false
  });
}


function showLevelUp(){
  const lvl=shuffledLevels[levelIndex];
  levelUp.style.display="block";
  levelUp.innerHTML = `<span style="color:#ffde59">Catch the</span><br><span style="color:#6aafff; font-weight:bold;">${lvl.target} ${lvl.emoji}</span>`;


  // Ø±ÛŒØ³Øª Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
  levelUp.style.animation="none";
  levelUp.offsetHeight; // force reflow
  levelUp.style.animation="levelPop 0.6s ease";

  setTimeout(()=>{
    levelUp.style.display="none";
  },1200);
}

function endGame(){
  gameOver = true;
  isPaused = true;
 bgMusic.pause();
  setTimeout(() => {
    document.getElementById("game").style.display = "none";
    const screen = document.getElementById("gameOverScreen");
    screen.style.display = "flex";

    document.getElementById("finalScore").textContent =
      "Final Score: " + score;
  }, 500);
}

function nextAnimal(){
  levelIndex = (levelIndex + 1) % shuffledLevels.length;

  correctOnThisAnimal = 0;
  animalStartTime = Date.now();

  clearWords();
  showLevelUp();
  updateUI();
}

function startGame() {
  if(hasStarted) return;
  hasStarted = true;

bgMusic.play().catch(()=>{});

  startBtn.style.display = "none";  // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Start
  animalStartTime = Date.now();
  isPaused = true;                  // Ø§ÙˆÙ„ Pause Ø¨Ø§Ø´Ù‡

  // Ù…Ø±Ø­Ù„Ù‡ Ø§ÙˆÙ„: Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø±Ø§Ù‡Ù†Ù…Ø§
  const guide = document.getElementById('guideMessage');
  guide.style.display = 'block';
bottomArrow.style.display = 'block';


  setTimeout(() => {
    guide.style.display = 'none';  // Ù…Ø®ÙÛŒ Ø´Ø¯Ù† Ù¾ÛŒØ§Ù… Ø±Ø§Ù‡Ù†Ù…Ø§
bottomArrow.style.display = 'none';
    // Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ…: Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø§ÙˆÙ„ÛŒÙ† Ø­ÛŒÙˆØ§Ù†
    const lvl = shuffledLevels[levelIndex];
    levelUp.style.display = "block";
    levelUp.innerHTML = `<span style="color:#ffde59">Catch the</span><br>
                         <span style="color:#6aafff; font-weight:bold;">${lvl.target} ${lvl.emoji}</span>`;
    levelUp.style.animation = "levelPop 0.6s ease";

    setTimeout(() => {
      levelUp.style.display = 'none';  // Ù…Ø®ÙÛŒ Ø´Ø¯Ù† Ù¾ÛŒØ§Ù… Ø­ÛŒÙˆØ§Ù†
      isPaused = false;                // Ø­Ø§Ù„Ø§ Ø¨Ø§Ø²ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯
      bgMusic.play();
    }, 1200); // Ù…Ø¯Øª Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø­ÛŒÙˆØ§Ù†

  }, 2500); // Ù…Ø¯Øª Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø±Ø§Ù‡Ù†Ù…Ø§
}

function togglePause(){
  if(!hasStarted) return;

  isPaused = !isPaused;

  if(isPaused){
    pauseStartTime = Date.now();
    pauseBtn.textContent = "â–¶";
    bgMusic.pause(); 
  }else{
    const pausedDuration = Date.now() - pauseStartTime;
    animalStartTime += pausedDuration;
    pauseBtn.textContent = "â¸";
    bgMusic.play();
  }
}

function restartGame(){
  location.reload();
}



function gameLoop(t){
  if(gameOver || isPaused){ 
    requestAnimationFrame(gameLoop); 
    return; 
  }

  const now = Date.now();

  // ØªØºÛŒÛŒØ± Ø­ÛŒÙˆØ§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø¯Ø§Ø¯ ØµØ­ÛŒØ­ ÛŒØ§ Ø²Ù…Ø§Ù†
  if(!isTransitioning && correctOnThisAnimal >= MAX_CORRECT){
  transitionToNextAnimal(true);   // Ù…ÙˆÙÙ‚ÛŒØª
}
else if(!isTransitioning && now - animalStartTime >= MAX_TIME){
  transitionToNextAnimal(false);  // ÙÙ‚Ø· Ø²Ù…Ø§Ù† ØªÙ…ÙˆÙ… Ø´Ø¯Ù‡
}



  // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù„Ù…Ø§Øª Ø¬Ø¯ÛŒØ¯
  if(t - lastSpawn > spawnInterval){
    spawnWord();

if(lives === 1 && Math.random() < 0.1){
    spawnHeart(); // ÛµÙª Ø§Ø­ØªÙ…Ø§Ù„
  }

    lastSpawn = t;
  }

  const pRect = player.getBoundingClientRect();

  for(let i = words.length - 1; i >= 0; i--){
    const w = words[i];

    if(w.toRemove){
      w.el.remove();
      words.splice(i,1);
      continue;
    }

    // Ø­Ø±Ú©Øª Ú©Ù„Ù…Ù‡
    if(!w.caught){
      w.y += speed;
      w.el.style.top = w.y + "px";
   
 const fadeStart = 0;   // Ø§Ø² Ú©Ø¬Ø§ Ø´Ø±ÙˆØ¹ Ø¨Ø´Ù‡
  const fadeEnd = 180;   // ØªØ§ Ú©Ø¬Ø§ Ú©Ø§Ù…Ù„Ø§Ù‹ Ù…Ø´Ø®Øµ Ø¨Ø´Ù‡
  let opacity = (w.y - fadeStart) / (fadeEnd - fadeStart);
  opacity = Math.min(Math.max(opacity, 0), 1); // clamp 0-1
  w.el.style.opacity = opacity;



 }

    const wRect = w.el.getBoundingClientRect();

    // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ù¾Ù„ÛŒØ±
    const hitMargin = 10; 
    const safeLeft   = pRect.left + hitMargin;
    const safeRight  = pRect.right - hitMargin;
    const safeTop    = pRect.top + hitMargin;
    const safeBottom = pRect.bottom - hitMargin;

    if(!w.caught &&
       wRect.bottom >= safeTop &&
       wRect.top <= safeBottom &&
       wRect.left <= safeRight &&
       wRect.right >= safeLeft
    ){
      w.caught = true; // Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù…! Ø«Ø¨Øª ÛŒÚ©Ø¨Ø§Ø± Ø¨Ø±Ø®ÙˆØ±Ø¯


if(w.isHeart){
  lives = Math.min(lives + 1, 3); // Ø³Ù‚Ù Û³ Ø¬ÙˆÙ†
  updateUI();
  w.toRemove = true;
  continue;
}



      if(w.isTarget){
        correctOnThisAnimal++;
        score++;
        w.el.classList.add("correct");
        

        // Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø®ØªÛŒ
        speed = Math.min(speed + 0.2, 8);
        spawnInterval = Math.max(spawnInterval - 120, 600);

      }else{
        w.el.classList.add("wrong");
        lives--;
       
 const errorSound = document.getElementById("errorSound");
  errorSound.currentTime = 0; // Ø§Ú¯Ø± Ú†Ù†Ø¯ Ø¨Ø§Ø± Ù¾Ø´Øª Ø³Ø± Ù‡Ù… Ø´Ø¯ØŒ Ø§Ø² Ø§ÙˆÙ„ Ù¾Ø®Ø´ Ú©Ù†
  errorSound.play();

const flash = document.getElementById("hitFlash");
    flash.style.background = "rgba(255,0,0,0.4)"; // Ù†ÛŒÙ…Ù‡ Ø´ÙØ§Ù Ù‚Ø±Ù…Ø²
    setTimeout(() => { flash.style.background = "rgba(255,0,0,0)"; }, 150); // Ú©Ù… Ú©Ù… Ù…Ø­Ùˆ Ø¨Ø´Ù‡


       if(lives <= 0) endGame();
      }

      updateUI();

      // Ø­Ø°Ù Ø§Ù…Ù† Ø¨Ø§ ØªØ§Ø®ÛŒØ±
      setTimeout(()=>{
        w.toRemove = true;
      }, 400);

      continue;
    }

    // Ø§ÙØªØ§Ø¯Ù† Ú©Ù„Ù…Ù‡ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† Ø²Ù…ÛŒÙ†
    const groundHeight = document.getElementById("ground").offsetHeight;
    if(w.y + w.el.offsetHeight > window.innerHeight - groundHeight){
      w.toRemove = true;
    }
  }

  requestAnimationFrame(gameLoop);
}

function transitionToNextAnimal(isSuccess){
  isTransitioning = true;
  isPaused = true;
  clearWords();

  let msg;

  if(isSuccess){
    const praiseMessages = [
      "Nice work!",
      "Good job!",
      "Excellent!",
      "Amazing!",
      "Well done!",
      "Great!"
    ];
    msg = praiseMessages[Math.floor(Math.random() * praiseMessages.length)];
  } else {
    const neutralMessages = [
      "Let's try a new one!",
      "Keep going!",
      "You can do better!",
      "Try again!"
    ];
    msg = neutralMessages[Math.floor(Math.random() * neutralMessages.length)];
  }

  levelUp.style.display = "block";
  levelUp.textContent = msg;

  setTimeout(() => {
    levelUp.style.display = "none";

    nextAnimal(); // ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ Ø­ÛŒÙˆØ§Ù† Ùˆ ØªØ§Ø±Ú¯Øª Ø¬Ø¯ÛŒØ¯

    // ÙØ§Ø² Û²: Ù…Ú©Ø« Ø¨Ø¹Ø¯ Ø§Ø² Ø¯ÛŒØ¯Ù† ØªØ§Ø±Ú¯Øª
    setTimeout(() => {
      isPaused = false;      // Ø­Ø§Ù„Ø§ ØªØ§Ø²Ù‡ Ø§Ø¬Ø§Ø²Ù‡ Ø¨Ø§Ø²ÛŒ
      isTransitioning = false;
    }, 1000); // Û± Ø«Ø§Ù†ÛŒÙ‡ Ø¯ÛŒØ¯Ù† ØªØ§Ø±Ú¯Øª

  }, 1000); // Û±.Û¸ Ø«Ø§Ù†ÛŒÙ‡ Ù¾ÛŒØ§Ù…
}



function movePlayer(x){
  player.style.left =
    Math.max(0,
      Math.min(window.innerWidth-player.offsetWidth,
      x-player.offsetWidth/2)
    )+"px";
}

player.addEventListener("touchmove",e=>{
  if(!isPaused&&!gameOver) movePlayer(e.touches[0].clientX);
});

let drag=false;
player.addEventListener("mousedown",()=>drag=true);
window.addEventListener("mouseup",()=>drag=false);
window.addEventListener("mousemove",e=>{
  if(drag&&!isPaused&&!gameOver) movePlayer(e.clientX);
});

updateUI();
requestAnimationFrame(gameLoop);
</script>
</body>
</html>
