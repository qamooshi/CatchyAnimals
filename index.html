<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Word Catcher - Stable Final</title>

<style>
  * { box-sizing: border-box; }
  body { margin:0; background:#fef6e4; font-family:Arial; overflow:hidden; }
  #game { position:relative; width:100vw; height:100vh; }

  #topBar {
    position:absolute; top:0; width:100%; height:70px;
    background:#fff; display:flex; justify-content:space-between;
    align-items:center; padding:10px 12px; z-index:20;
  }

  #player {
    position:absolute; bottom:78px; left: calc(50% - 45px); 
    
    width:90px; height:90px;
    background:url('images/cat.png') no-repeat center/contain;
    touch-action:none;
z-index:7;
  }

  .word {
    position:absolute;
    padding:12px 28px;
    background:#ffd803;
    border-radius:18px;
    font-size:26px;
    font-weight:bold;
    user-select:none;
  }

  .word.correct { background:#7CFF7C; }
  .word.wrong   { background:#FF7C7C; }

  #message,#levelUp {
    position:absolute; width:100%; text-align:center;
    font-size:32px; top:40%; display:none; z-index:30;
  }

  #controls {
    position:absolute; bottom:0; width:100%;
    display:flex; justify-content:space-around;
    padding:10px; background:#fff;
z-index: 6
  }

  button {
    padding:12px 18px;
    border-radius:18px;
    border:none;
    font-size:18px;
    background:#8bd3dd;
    width:30%;
  }
#levelUp {
  position:absolute;
  width:100%;
  text-align:center;
  font-size:40px;
  top:40%;
  z-index:30;
  color:#333;
  font-weight:bold;
  animation: none;
}

@keyframes levelPop {
  0%   { transform:scale(0.4); opacity:0; }
  60%  { transform:scale(1.2); opacity:1; }
  100% { transform:scale(1);   opacity:1; }
}
#ground {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 80px;       /* Ø§Ø±ØªÙØ§Ø¹ Ø²Ù…ÛŒÙ† */
  background: #654321; /* Ø±Ù†Ú¯ Ø²Ù…ÛŒÙ† (Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ) */
  z-index: 5;
}

</style>
</head>

<body>
<div id="game">
  <div id="topBar">
    <div id="target"></div>
    <div id="score"></div>
    <div id="hearts"></div>
  </div>

  <div id="player"></div>
  <div id="message"></div>
  <div id="levelUp"></div>

  <div id="controls">
    <button onclick="startGame()">Start</button>
    <button onclick="pauseGame()">Pause</button>
    <button onclick="restartGame()">Restart</button>
  </div>
</div>
<div id="ground"></div>

<script>
const levels = [
  { target:"Cat",  emoji:"ğŸ±", words:["Cat","Dog","Monkey","Lion"], image:"images/cat.png" },
  { target:"Dog",  emoji:"ğŸ¶", words:["Dog","Cat","Cow","Frog"],   image:"images/dog.png" },
  { target:"Monkey", emoji:"ğŸµ", words:["Monkey","Jellyfish","Lion","Dog"],image:"images/monkey.png" },
  { target:"Jellyfish", emoji:"ğŸª¼", words:["Jellyfish","Cat","Dog","Monkey"], image:"images/jellyfish.png" },
  { target:"Lion", emoji:"ğŸ¦", words:["Lion","Tiger","Jellyfish","Elephant"], image:"images/lion.png" },
  { target:"Frog", emoji:"ğŸ¸", words:["Frog","Cat","Bear","Dog"], image:"images/frog.png" }


];

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

let shuffledLevels=[...levels];
shuffle(shuffledLevels);

let spawnInterval = 2500;
let score=0, lives=3, levelIndex=0, speed=1.5;
let gameOver=false, isPaused=true;
let words=[], lastSpawn=0;
let correctOnThisAnimal = 0;
let animalStartTime = Date.now();


const player=document.getElementById("player");
const targetEl=document.getElementById("target");
const scoreEl=document.getElementById("score");
const heartsEl=document.getElementById("hearts");
const levelUp=document.getElementById("levelUp");
const message=document.getElementById("message");
const game=document.getElementById("game");
const MAX_CORRECT = 5;   // N
const MAX_TIME = 40000; // T = 40 Ø«Ø§Ù†ÛŒÙ‡


function updateUI(){
  const lvl=shuffledLevels[levelIndex];
  targetEl.textContent=`Catch: ${lvl.target} ${lvl.emoji}`;
  scoreEl.textContent=`Score: ${score}`;
  heartsEl.textContent="â¤ï¸".repeat(lives);
  player.style.backgroundImage=`url('${lvl.image}')`;
}

// ÙÙ‚Ø· ÙÙ„Ú¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…ØŒ Ø­Ø°Ù ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ø§Ø®Ù„ loop
function clearWords(){
  words.forEach(w => w.toRemove = true);
}

function spawnWord(){
  const lvl=shuffledLevels[levelIndex];
  const text=lvl.words[Math.floor(Math.random()*lvl.words.length)];
  const el=document.createElement("div");
  el.className="word";
  el.textContent=text;
  el.style.left=Math.random()*(window.innerWidth-150)+"px";
  el.style.top="80px";
  game.appendChild(el);

  words.push({
    el,
    y:80,
    isTarget:text.toLowerCase()===lvl.target.toLowerCase(),
    caught:false,
    toRemove:false
  });
}

function showLevelUp(){
  const lvl=shuffledLevels[levelIndex];
  levelUp.style.display="block";
  levelUp.textContent=`NEW TARGET!\n${lvl.target} ${lvl.emoji}`;

  // Ø±ÛŒØ³Øª Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
  levelUp.style.animation="none";
  levelUp.offsetHeight; // force reflow
  levelUp.style.animation="levelPop 0.6s ease";

  setTimeout(()=>{
    levelUp.style.display="none";
  },1200);
}

function endGame(){
  gameOver=true;
  message.style.display="block";
  message.textContent="Game Over!";
}

function nextAnimal(){
  levelIndex = (levelIndex + 1) % shuffledLevels.length;

  correctOnThisAnimal = 0;
  animalStartTime = Date.now();

  clearWords();
  showLevelUp();
  updateUI();
}


function speakWord(text){
  const utter=new SpeechSynthesisUtterance(text);
  utter.lang="en-US";
  utter.rate=0.8;
  speechSynthesis.speak(utter);
}

function gameLoop(t){
  if(gameOver || isPaused){ 
    requestAnimationFrame(gameLoop); 
    return; 
  }

  const now = Date.now();

  // ØªØºÛŒÛŒØ± Ø­ÛŒÙˆØ§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø¯Ø§Ø¯ ØµØ­ÛŒØ­ ÛŒØ§ Ø²Ù…Ø§Ù†
  if(correctOnThisAnimal >= MAX_CORRECT || now - animalStartTime >= MAX_TIME){
    nextAnimal();
  }

  // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù„Ù…Ø§Øª Ø¬Ø¯ÛŒØ¯
  if(t - lastSpawn > spawnInterval){
    spawnWord();
    lastSpawn = t;
  }

  const pRect = player.getBoundingClientRect();

  for(let i = words.length - 1; i >= 0; i--){
    const w = words[i];

    if(w.toRemove){
      w.el.remove();
      words.splice(i,1);
      continue;
    }

    // Ø­Ø±Ú©Øª Ú©Ù„Ù…Ù‡
    if(!w.caught){
      w.y += speed;
      w.el.style.top = w.y + "px";
    }

    const wRect = w.el.getBoundingClientRect();

    // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ù¾Ù„ÛŒØ±
    const hitMargin = 10; 
    const safeLeft   = pRect.left + hitMargin;
    const safeRight  = pRect.right - hitMargin;
    const safeTop    = pRect.top + hitMargin;
    const safeBottom = pRect.bottom - hitMargin;

    if(!w.caught &&
       wRect.bottom >= safeTop &&
       wRect.top <= safeBottom &&
       wRect.left <= safeRight &&
       wRect.right >= safeLeft
    ){
      w.caught = true; // Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù…! Ø«Ø¨Øª ÛŒÚ©Ø¨Ø§Ø± Ø¨Ø±Ø®ÙˆØ±Ø¯

      if(w.isTarget){
        correctOnThisAnimal++;
        score++;
        w.el.classList.add("correct");
        speakWord(w.el.textContent);

        // Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø®ØªÛŒ
        speed = Math.min(speed + 0.2, 6);
        spawnInterval = Math.max(spawnInterval - 120, 700);

      }else{
        w.el.classList.add("wrong");
        lives--;
        if(lives <= 0) endGame();
      }

      updateUI();

      // Ø­Ø°Ù Ø§Ù…Ù† Ø¨Ø§ ØªØ§Ø®ÛŒØ±
      setTimeout(()=>{
        w.toRemove = true;
      }, 400);

      continue;
    }

    // Ø§ÙØªØ§Ø¯Ù† Ú©Ù„Ù…Ù‡ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† Ø²Ù…ÛŒÙ†
    const groundHeight = document.getElementById("ground").offsetHeight;
    if(w.y + w.el.offsetHeight > window.innerHeight - groundHeight){
      w.toRemove = true;
    }
  }

  requestAnimationFrame(gameLoop);
}

function movePlayer(x){
  player.style.left =
    Math.max(0,
      Math.min(window.innerWidth-player.offsetWidth,
      x-player.offsetWidth/2)
    )+"px";
}

player.addEventListener("touchmove",e=>{
  if(!isPaused&&!gameOver) movePlayer(e.touches[0].clientX);
});

let drag=false;
player.addEventListener("mousedown",()=>drag=true);
window.addEventListener("mouseup",()=>drag=false);
window.addEventListener("mousemove",e=>{
  if(drag&&!isPaused&&!gameOver) movePlayer(e.clientX);
});

function startGame(){ isPaused=false; }
function pauseGame(){ isPaused=true; }
function restartGame(){ location.reload(); }

updateUI();
requestAnimationFrame(gameLoop);
</script>
</body>
</html>
